# Upgrading to Group Calling

Upgrading to group calling is a fairly simple process, but one that does require some code changes.

## Spark Config

Since group calling is an experimental feature, you must enable it
in your Spark config object:

```js
var CiscoSpark = require('ciscospark');
var spark = CiscoSpark.init({
  config: {
    phone: {
      enableExperimentalGroupCallingSupport: true
    }
  }
});
```

## Event Changes

Once group calling support is enabled, the call events that are
emitted will change:

* `call.on('connected')`
  * This event is deprecated and should not be relied upon for call state.
  * You can use `call.on('active')` to determine call state. One thing to keep in mind,
    as soon as one participant joins a call, it is now considered "active".
  * To determine the current user's connected state, use the membership state
    (more on that below) by listening to
    `call.on('change:me', () => active = call.me === 'connected')`
* `call.on('di`sc`onnected')`
  * This event is deprecated and should not be relied upon for call state.
  * You can use `call.on('inactive')` to
    determine if a call is no longer active. (This
    is usually a good indicator that you should
    hang up the call.)
* `call.on('change:status')`
  * The `call.status` object is deprecated and is replaced by `call.state`.
  * Listen for call state changes by listening to `call.on('change:state')`
  * `call.state` can be either `active` or `inactive`
  * The concept of "ringing" another user doesn't fit for group calling.
    If you were using `call.status === 'ringing'`, the problem is that
    group calls are automatically connected and waiting for participants.
    In order to check for a 1:1 "ringing" you can use the `remoteMember`
    call helper and check `call.remoteMember.state === "notified"`.

## Call Memberships

Since we have multiple call members in a group call, we now have a new way
to track the state of each of those members via call memberships.

`call.memberships` is a collection of the call members that you can iterate
through. Some notable features of the membership object are:

* `member.state` - Indicates the member's relationship with the call:
  * - notified - the party has been invited to the call but has not yet accepted
  * - connected - the party is participating in the call
  * - declined - the party chose not to accept the call
  * - disconnected - the party is no longer participating in the call
* `member.audioMuted` indicates if the member has muted their microphone
* `member.videoMuted` indicates if the member has disable their camera

## Helpers

Some other helpful properties have been added to the call object as well:

* `call.me` is an easy reference to the current user's call membership object
* `call.remoteMember` is a reference to the other user's membership object in a 1:1 call
* `call.isCall` is a helper flag to signal if this is a call (1:1) or meeting (group)